import{r as o,j as e}from"./react-Dzin6bBt.js";import{u as L,a as p}from"./index-CBuvP9i_.js";import{T as R}from"./textarea-D4cawpQl.js";import{B as C}from"./button-DaQ_XCGK.js";import{I as u}from"./input-qtv16FpJ.js";import{L as c}from"./react-router-dom-C6AuuY1s.js";import{c as W,g as _,d as P}from"./react-router-ZyCTy2W0.js";import"./exenv-BTN8Bl8p.js";import"./react-dom-vuVZB_ht.js";import"./scheduler-CzFDRTuY.js";import"./axios-CCb-kr4I.js";import"./@radix-ui-BiFA3u8r.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-Bffst3Sv.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C0y-sxxv.js";import"./react-style-singleton-CNUZfl4K.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BgPSE0Zt.js";import"./use-callback-ref-CM22xisT.js";import"./@floating-ui-B50KHoMa.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-Dnoi3Axr.js";import"./lucide-react-DVh0U7qo.js";import"./@remix-run--NbqtF80.js";import"./class-variance-authority-Bb4qSo10.js";function ue(){const{user:l}=L(),n=W();o.useEffect(()=>{["owner","admin","cdmiadmin","cdmi"].includes(l.role)||n("/404")},[l,n]);const[w,h]=o.useState(""),[j,x]=o.useState(""),[N,v]=o.useState(l.username),[k,y]=o.useState(""),[D,E]=o.useState([]),[F,S]=o.useState([]),[U,m]=o.useState(!1),[a,f]=o.useState("create"),{id:i}=_(),d=P().pathname;o.useEffect(()=>{d.includes("/new")?f("create"):d.includes("/edit")&&i?(f("update"),["owner","admin","cdmiadmin"].includes(l.role)||n("/404"),m(!0),p.get(`/row/${i}`).then(({data:t})=>{if(m(!1),h(t.title||""),x(t.description||""),v(t.author||""),y(t.created_at||""),t.files){const s=JSON.parse(t.files);S(s.map(r=>r.replace(/\\/,"/")))}}).catch(()=>{m(!1)})):d.includes("/")&&i&&(f("show"),m(!0),p.get(`/row/${i}`).then(({data:t})=>{if(m(!1),h(t.title||""),x(t.description||""),v(t.author||""),y(t.created_at||""),t.files){const s=JSON.parse(t.files);S(s.map(r=>r.replace(/\\/,"/")))}}).catch(()=>{m(!1)}))},[d,i]);const T=t=>{const s=[...t.target.files];E(s)},$=t=>{t.preventDefault();const s=new FormData;s.append("title",w),s.append("description",j),s.append("author",N||l.username),D.forEach((g,A)=>{s.append(`files[${A}]`,g)});const r=a==="update"?`/row/${i}`:"/row";(a==="update"?p.put:p.post)(r,s,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>n("/row")).catch(g=>console.error(a==="update"?"Error updating Row Items":"Error creating Row Items",g))},I=t=>t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png")?"image":t.endsWith(".pdf")?"pdf":"other";return e.jsx("div",{className:"p-4 max-w-6xl mx-auto",children:e.jsxs("form",{onSubmit:$,className:"mt-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title"}),e.jsx(u,{type:"text",value:w,onChange:t=>h(t.target.value),className:"mt-1",disabled:a==="show"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx(R,{value:j,onChange:t=>x(t.target.value),className:"mt-1",disabled:a==="show"})]}),["owner","admin","cdmiadmin"].includes(l.role)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Author"}),e.jsx(u,{type:"text",value:N,className:"mt-1",disabled:!0})]}),a!=="create"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Created At"}),e.jsx(u,{type:"text",value:k,className:"mt-1",disabled:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Files"}),e.jsx(u,{type:"file",multiple:!0,onChange:T,className:"mt-1 text-white-400",disabled:a==="show"||a==="update"}),a==="show"&&F.length>0&&e.jsx("div",{className:"mt-2",children:F.map((t,s)=>{const r=`https://my.thedhruvish.com/api/storage/${t}`,b=I(r);return e.jsx("div",{className:"mb-2",children:b==="image"?e.jsxs("div",{children:[e.jsx("img",{src:r,alt:`File ${s+1}`,className:"max-w-xs max-h-40 object-cover"}),e.jsxs(c,{to:r,download:!0,className:"text-blue-600 hover:underline",children:["Download Image ",s+1]})]}):b==="pdf"?e.jsxs("div",{children:[e.jsxs(c,{to:r,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["View PDF ",s+1]}),e.jsxs(c,{to:r,download:!0,className:"text-blue-600 hover:underline ml-2",children:["Download PDF ",s+1]})]}):e.jsxs("div",{children:[e.jsxs(c,{to:r,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["View File ",s+1]}),e.jsxs(c,{to:r,download:!0,className:"text-blue-600 hover:underline ml-2",children:["Download File ",s+1]})]})},s)})})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(C,{type:a==="show"?"button":"submit",className:"bg-blue-500 text-white hover:bg-blue-600 w-[100px]",onClick:()=>a==="show"&&n(`/row/${i}/edit`),children:a==="update"?"Update":a==="show"?"Edit":"Create"}),e.jsx(C,{type:"button",className:"bg-gray-500 text-white hover:bg-gray-600 w-[100px]",onClick:()=>n("/row"),children:"Go To Home"})]})]})})}export{ue as default};
