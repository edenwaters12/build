import{r as o,j as t}from"./react-Dzin6bBt.js";import{M as q}from"./react-modal-CR9hn9WS.js";import{B as H}from"./button-DaQ_XCGK.js";import{I as Q}from"./input-qtv16FpJ.js";import{L as C}from"./Loader-BO7wm5pM.js";import{u as X,a as J}from"./index-CBuvP9i_.js";import{X as K,A as V,e as Y}from"./lucide-react-DVh0U7qo.js";import"./exenv-BTN8Bl8p.js";import"./react-dom-vuVZB_ht.js";import"./scheduler-CzFDRTuY.js";import"./prop-types-BKNjMPK8.js";import"./warning-BwjNEfsz.js";import"./react-lifecycles-compat-DsJokh4A.js";import"./@radix-ui-BiFA3u8r.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-Bffst3Sv.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C0y-sxxv.js";import"./react-style-singleton-CNUZfl4K.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BgPSE0Zt.js";import"./use-callback-ref-CM22xisT.js";import"./@floating-ui-B50KHoMa.js";import"./class-variance-authority-Bb4qSo10.js";import"./react-router-dom-C6AuuY1s.js";import"./react-router-ZyCTy2W0.js";import"./@remix-run--NbqtF80.js";import"./axios-CCb-kr4I.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-Dnoi3Axr.js";q.setAppElement("#root");const Ce=()=>{const{user:Z,setNotification:n,notification:v}=X(),[a,y]=o.useState([]),[f,L]=o.useState(null),[A,g]=o.useState(""),[d,N]=o.useState(!1),[S,x]=o.useState(0),[h,w]=o.useState(!0),[i,E]=o.useState(null),[R,c]=o.useState(!1),[F,I]=o.useState(!1),l=o.useRef(),[P,T]=o.useState(!1),[m,U]=o.useState({client_id:"",client_secret:"",refresh_token:""}),z=e=>U({...m,[e.target.name]:e.target.value}),B=async e=>{const{client_id:s,client_secret:r,refresh_token:u}=m,p="https://oauth2.googleapis.com/token",j=new URLSearchParams({client_id:s,client_secret:r,refresh_token:u,grant_type:"refresh_token"}),k=await fetch(p,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:j});if(!k.ok)throw h(!0),new Error("Failed to get access token: "+k.statusText);return(await k.json()).access_token},b=async(e,s=!1)=>{if(n("new data Fetching"),!!i){s?c(!0):I(!0);try{const r=`https://photoslibrary.googleapis.com/v1/mediaItems?pageToken=${e||""}`,u=await fetch(r,{headers:{Authorization:`Bearer ${i}`}});if(!u.ok)throw new Error("Failed to fetch photos: "+u.statusText);const p=await u.json();y(j=>[...j,...p.mediaItems||[]]),L(p.nextPageToken)}catch(r){n(r.message)}finally{c(!1),I(!1)}}},_=async()=>{try{if(y([]),i)await b("",!0);else{const e=await B(m.refresh_token);E(e)}}catch(e){n(e.message)}};o.useEffect(()=>{i&&b("",!0)},[i]);const M=e=>{var s;x(e),g((s=a[e])==null?void 0:s.baseUrl),N(!0)},W=()=>{N(!1)},$=()=>{var e;x(s=>s===a.length-1?0:s+1),g((e=a[(S+1)%a.length])==null?void 0:e.baseUrl)},D=()=>{var e;x(s=>s===0?a.length-1:s-1),g((e=a[(S-1+a.length)%a.length])==null?void 0:e.baseUrl)},G=e=>{e.preventDefault(),T(!0),c(!0);const s=new URLSearchParams(window.location.search).get("save");J.post("/google-photos",{...m}).then(async()=>{c(!1),w(!1),n("Start the data Fetching"),await _()}).catch(async r=>{n(r.message),s&&(n("Start the data Fetching"),w(!1),await _())}).finally(()=>{c(!1),T(!1)})};o.useEffect(()=>{const e=()=>{f&&!d&&b(f,!1)},s=new IntersectionObserver(r=>{r[0].isIntersecting&&e()});return l.current&&s.observe(l.current),()=>{l.current&&s.unobserve(l.current)}},[f,d]);const O=()=>{w(!h)};return t.jsxs("div",{className:"container",children:[F&&t.jsxs("div",{className:"flex items-center justify-center p-4",children:[t.jsx(C,{})," "]}),t.jsxs("h1",{className:"text-5xl font-semibold cursor-pointer text-center",onClick:O,children:[h?"image":"Go to Home"," "]}),h?t.jsxs("form",{onSubmit:G,className:"p-4 max-w-6xl mx-auto mt-4",children:[["client_id","client_secret","refresh_token"].map(e=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300",children:e}),t.jsx(Q,{type:"text",name:e,value:m[e],onChange:z,className:"mt-1",required:!0})]},e)),t.jsx(H,{type:"submit",disabled:P,className:" hover:bg-blue-600 w-[150px]",children:P?".....":"save"})]}):t.jsxs("div",{children:[R?t.jsx("div",{className:"flex items-center justify-center p-4"}):t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 p-4",children:a.map((e,s)=>t.jsx("div",{className:"overflow-visible p-2 rounded-lg shadow-lg object-cover ",children:t.jsx("img",{src:`${e.baseUrl}=w300`,alt:"Photo",onClick:()=>M(s),className:"m-2 w-full max-w-[300px] object-cover hover:scale-105 transition-transform duration-300 cursor-pointer"})},e.id))}),t.jsx("div",{ref:l,className:"h-5 mb-5"}),F&&!d&&t.jsxs("div",{className:"flex items-center justify-center p-4",children:[t.jsx(C,{})," "]}),d&&t.jsxs("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-90 flex justify-center items-center",children:[t.jsx(K,{size:80,color:"#5384a2",strokeWidth:2.75,onClick:W,className:"absolute top-5 right-5 bg-opacity-50 rounded px-4 py-2 cursor-pointer"}),t.jsx(V,{size:80,color:"#5384a2",strokeWidth:2.75,onClick:D,className:"absolute left-5 rounded px-4 py-2 cursor-pointer "}),t.jsx(Y,{size:80,color:"#5384a2",strokeWidth:2.75,onClick:$,className:"absolute right-5 bg-opacity-50 rounded px-4 py-2 cursor-pointer"}),t.jsx("img",{src:A,alt:"Full Screen",className:"max-w-[90%] max-h-[90%]"})]})]}),v&&t.jsx("div",{className:"fixed bottom-4 right-4 p-4 bg-gray-800 text-white rounded-lg shadow-lg",children:v})]})};export{Ce as default};
