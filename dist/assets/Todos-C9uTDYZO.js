import{r as o,j as t}from"./react-Dzin6bBt.js";import{u as B,f as L,c as O,g as Q,a as F}from"./@tanstack-CWJAimbQ.js";import{u as U,a as E}from"./index-B14-NT0x.js";import{S as q,a as z,b as G,c as n}from"./select-BTO3kTK9.js";import{L as J}from"./react-router-dom-BJiSrDzD.js";import{B as D}from"./button-Co5OAmAE.js";import{C as K}from"./card-B4MdaAfh.js";import{L as H}from"./Loader-BO7wm5pM.js";import{T as W,a as X,b as V,c as Y,d as Z,e as ee}from"./table-CnlVV16C.js";import{A as te}from"./AlertDialogDemo-K33nJDts.js";import{I as se}from"./input-nng-uUd-.js";import{c as oe}from"./react-router-CsBO2-kY.js";import"./exenv-BTN8Bl8p.js";import"./react-dom-vuVZB_ht.js";import"./scheduler-CzFDRTuY.js";import"./axios-CCb-kr4I.js";import"./@radix-ui-DNVY2g9C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fK1ikR0O.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C0y-sxxv.js";import"./react-style-singleton-CNUZfl4K.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BGkMMORt.js";import"detect-node-es";import"./use-callback-ref-CM22xisT.js";import"./@floating-ui-B50KHoMa.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-Dnoi3Axr.js";import"./lucide-react-DVh0U7qo.js";import"./@remix-run-CDTKzl14.js";import"./class-variance-authority-Bb4qSo10.js";function _e(){const{user:l,setNotification:b}=U(),x=oe(),[d,g]=o.useState([]),[a,M]=o.useState("all"),[c,f]=o.useState(!1),[v,S]=o.useState(null),[R,h]=o.useState(!1),[i,y]=o.useState(""),[k,j]=o.useState(1),[A,_]=o.useState(),[m,w]=o.useState(!0);o.useEffect(()=>{l.role==="owner"||l.role==="admin"||l.role==="cdmiadmin"||x("/404")},[l,x]);const C=()=>{!m||c||(f(!0),E.get(`/todos?page=${k}${a!=="all"?`&category=${a}`:""}`).then(e=>{g(s=>[...s,...e.data.data.filter(u=>!s.some(p=>p.id===u.id))]),_(e.data.total),e.data.current_page==e.data.last_page&&w(!1),j(s=>s+1),f(!1)}).catch(e=>{console.error("Error fetching todos",e),f(!1)}))};o.useEffect(()=>{C()},[a]),o.useEffect(()=>{const e=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-100&&m&&!c&&C()};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[m,c]);const $=e=>{S(e),h(!0)},I=()=>{v&&E.delete(`/todos/${v.id}`).then(()=>{b("deleted successfully"),g([]),j(1),w(!0),C()}).catch(e=>{console.log(e),b("Error deleting todo",e)}),h(!1),S(null)},r=O(),P=o.useMemo(()=>[r.accessor("today_date",{header:"Date",cell:e=>e.getValue()}),r.accessor("category",{header:"Category",cell:e=>e.getValue().toUpperCase()}),r.accessor("title",{header:"Title",cell:e=>e.getValue()}),r.accessor("topic",{header:"Topic",cell:e=>e.getValue()}),r.accessor("description",{header:"Description",cell:e=>e.getValue()?e.getValue().length>25?`${e.getValue().substring(0,25)}...`:e.getValue():" "}),r.display({id:"actions",header:"Actions",cell:({row:e})=>(l.role==="owner"||l.role==="admin")&&t.jsxs(t.Fragment,{children:[t.jsx(J,{to:`/science/${e.original.id}`,className:"text-blue-500 hover:underline",children:"Show"}),t.jsx(D,{className:"ml-4 bg-red-500 text-white hover:bg-red-600",onClick:()=>$(e.original),children:"Delete"})]})})],[l]),T=o.useMemo(()=>d.filter(e=>{var s,u,p;return(((s=e.title)==null?void 0:s.toLowerCase())||"").includes(i.toLowerCase())||(((u=e.topic)==null?void 0:u.toLowerCase())||"").includes(i.toLowerCase())||(((p=e.description)==null?void 0:p.toLowerCase())||"").includes(i.toLowerCase())}),[d,i]),N=B({data:T,columns:P,getCoreRowModel:Q(),getSortedRowModel:F()});return t.jsxs("div",{className:"p-4 mx-auto",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4",children:[t.jsx("h1",{className:"text-2xl font-semibold cursor-pointer",onClick:()=>y(""),children:"Data Science Lecturers"}),t.jsxs("h3",{children:["Total : ",A]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center w-full sm:w-auto sm:space-x-4",children:[t.jsx("div",{className:"w-full sm:w-1/2 mb-4 sm:mb-0 sm:order-1 mr-6",children:t.jsxs(q,{value:a,onValueChange:e=>{M(e),g([]),j(1),w(!0)},className:"mt-1 block w-full",children:[t.jsx(z,{className:"xl:w-[150px]",children:t.jsx("span",{children:a||"---select---"})}),t.jsxs(G,{children:[t.jsx(n,{value:"all",children:"All"}),t.jsx(n,{value:"lecturer",children:"Lecturer"}),t.jsx(n,{value:"public_holidays",children:"Public Holidays"}),t.jsx(n,{value:"no_lecturer",children:"No Lecturer"}),t.jsx(n,{value:"time_e",children:"Time E"})]})]})}),t.jsx(se,{type:"text",placeholder:"Search",value:i,onChange:e=>y(e.target.value),className:"py-2 px-4 rounded-md focus:outline-none focus:ring-2 sm:order-2 xl:w-[200px]"}),t.jsx(D,{className:"bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:order-2 xl:w-[100px]",onClick:()=>x("/science/new"),children:"Create"})]})]}),t.jsxs("div",{className:"mt-8",children:[t.jsxs(K,{className:"overflow-x-auto",children:[c&&d.length===0?t.jsx("div",{className:"flex items-center justify-center p-4",children:t.jsx(H,{})}):T.length>0?t.jsxs(W,{children:[t.jsx(X,{children:N.getHeaderGroups().map(e=>t.jsx(V,{children:e.headers.map(s=>t.jsx(Y,{className:"cursor-pointer",children:s.isPlaceholder?null:t.jsxs("div",{onClick:s.column.getToggleSortingHandler(),children:[L(s.column.columnDef.header,s.getContext()),{asc:" ðŸ”¼ ",desc:" ðŸ”½ "}[s.column.getIsSorted()]??null]})},s.id))},e.id))}),t.jsx(Z,{children:N.getRowModel().rows.map(e=>t.jsx(V,{children:e.getVisibleCells().map(s=>t.jsx(ee,{children:L(s.column.columnDef.cell,s.getContext())},s.id))},e.id))})]}):t.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"No todos found."}),c&&m&&d.length!=0&&t.jsx("div",{className:"flex items-center justify-center p-4",children:t.jsx(H,{})})]}),t.jsx(te,{open:R,onClose:()=>h(!1),onConfirm:I,title:"Confirm Deletion",description:"Are you sure you want to delete this todo? This action cannot be undone."})]})]})}export{_e as default};
