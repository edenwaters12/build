import{f as V,u as A,b as E,r as l,j as o,L as m,a as h}from"./index-m0cxoX_N.js";import{u as H,f as N,c as I,g as F,a as O}from"./index-9l4Wx857.js";import{B as x}from"./button-Bx0ruhaM.js";import{C as U}from"./card-Ca12wPQC.js";import{L as _}from"./Loader-CIzex3is.js";import{T as B,a as P,b as S,c as Q,d as q,e as z}from"./table-DNzDlfVw.js";import{A as J}from"./AlertDialogDemo-DvZxjHf-.js";import{I as G}from"./input-dXRYiVVa.js";/**
 * @license lucide-react v0.436.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=V("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function le(){const{user:r,setNotification:g}=A(),i=E(),[f,T]=l.useState([]),[k,d]=l.useState(!1),[w,p]=l.useState(null),[R,u]=l.useState(!1),[c,b]=l.useState("");l.useEffect(()=>{["owner","row"].some(s=>r.role.includes(s))||i("/404")},[r,i]);const j=()=>{d(!0),h.get("/rows").then(s=>{T(s.data),d(!1)}).catch(s=>{console.error("Error fetching todos",s),d(!1)})};l.useEffect(()=>{j()},[]);const D=s=>{p(s),u(!0)},L=()=>{w&&h.delete(`/row/${w.id}`).then(()=>{g("row was successfully deleted"),j()}).catch(s=>{g("Error deleting todo",s)}),u(!1),p(null)},$=async s=>{try{const e=await h.get(`/row/${s}/download`,{responseType:"blob"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,console.log(t),a.setAttribute("download",`${s}_${Date.now()}__${Math.random().toString(36).substring(2,10)}.zip`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}catch(e){console.error("Download failed:",e),alert("Failed to download the file. Please try again.")}},n=I(),M=l.useMemo(()=>{const s=[n.accessor("title",{header:"Title",cell:e=>e.getValue()}),n.accessor("description",{header:"Description",cell:e=>e.getValue()?e.getValue().length>25?`${e.getValue().substring(0,25)}...`:e.getValue():" "}),n.accessor("files",{header:"Files",cell:e=>{const t=JSON.parse(e.getValue()||"[]");return t.length>0?t.map((a,v)=>o.jsxs(o.Fragment,{children:[o.jsxs(m,{to:`https://mydapi.thedhruvish.com/storage/${a}`,className:"text-blue-500 hover:underline",target:"_blank",children:["View File ",v+1]},v),t.length>0&&o.jsx(x,{onClick:()=>$(e.row.original.id),children:o.jsx(K,{})})]})):"No files"}}),n.display({id:"actions",header:"Actions",cell:({row:e})=>r.role==="owner"||r.role==="admin"?o.jsxs(o.Fragment,{children:[o.jsx(m,{to:`/row/${e.original.id}`,className:"text-blue-500 hover:underline",children:"Show"}),["owner","row-d"].some(t=>r.role.includes(t))&&o.jsx(x,{className:"ml-4 hover:bg-red-600",onClick:()=>D(e.original),children:"Delete"})]}):o.jsx(m,{to:`/row/${e.original.id}`,className:"text-blue-500 hover:underline",children:"Show"})})];return(r.role==="owner"||r.role==="admin")&&s.push(n.accessor("author",{header:"Author",cell:e=>e.getValue()})),s},[n,r.role]),C=l.useMemo(()=>(f||[]).filter(s=>{var e,t;return(((e=s.title)==null?void 0:e.toLowerCase())||"").includes(c.toLowerCase())||(((t=s.description)==null?void 0:t.toLowerCase())||"").includes(c.toLowerCase())}),[f,c]),y=H({data:C,columns:M,getCoreRowModel:F(),getSortedRowModel:O()});return o.jsxs("div",{className:"p-4 mx-auto",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4",children:[o.jsx("h1",{className:"text-2xl font-semibold cursor-pointer",onClick:()=>b(""),children:"Row Items"}),o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center w-full sm:w-auto sm:space-x-4",children:[o.jsx(G,{type:"text",placeholder:"Search",value:c,onChange:s=>b(s.target.value),className:"py-2 px-4 rounded-md focus:outline-none focus:ring-2 sm:order-2 xl:w-[200px]"}),o.jsx(x,{className:"bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:order-2 xl:w-[100px]",onClick:()=>i("/row/new"),children:"Create"})]})]}),o.jsxs("div",{className:"mt-8",children:[o.jsx(U,{className:"overflow-x-auto",children:k?o.jsx("div",{className:"flex items-center justify-center p-4",children:o.jsx(_,{})}):C.length>0?o.jsxs(B,{children:[o.jsx(P,{children:y.getHeaderGroups().map(s=>o.jsx(S,{children:s.headers.map(e=>o.jsx(Q,{className:"cursor-pointer",children:e.isPlaceholder?null:o.jsxs("div",{onClick:e.column.getToggleSortingHandler(),children:[N(e.column.columnDef.header,e.getContext()),{asc:" ðŸ”¼ ",desc:" ðŸ”½ "}[e.column.getIsSorted()]??null]})},e.id))},s.id))}),o.jsx(q,{children:y.getRowModel().rows.map(s=>o.jsx(S,{children:s.getVisibleCells().map(e=>o.jsx(z,{children:N(e.column.columnDef.cell,e.getContext())},e.id))},s.id))})]}):o.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"No rows found."})}),o.jsx(J,{open:R,onClose:()=>u(!1),onConfirm:L,title:"Confirm Deletion",description:"Are you sure you want to delete this todo? This action cannot be undone."})]})]})}export{le as default};
