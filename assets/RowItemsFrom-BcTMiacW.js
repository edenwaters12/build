import{u as L,c as R,r,d as W,q as _,a as u,j as t,I as h,s as P,L as d,B as S}from"./index-C80r3nWj.js";function O(){const{user:o}=L(),n=R();r.useEffect(()=>{["owner","row"].some(e=>o.role.includes(e))||n("/404")},[o,n]);const[g,p]=r.useState(""),[j,x]=r.useState(""),[N,v]=r.useState(o.username),[k,y]=r.useState(""),[D,$]=r.useState([]),[F,C]=r.useState([]),[U,c]=r.useState(!1),[a,f]=r.useState("create"),{id:i}=W(),m=_().pathname;r.useEffect(()=>{m.includes("/new")?f("create"):m.includes("/edit")&&i?(["owner","row-e"].some(e=>o.role.includes(e))||n("/404"),f("update"),c(!0),u.get(`/row/${i}`).then(({data:e})=>{if(c(!1),p(e.title||""),x(e.description||""),v(e.author||""),y(e.created_at||""),e.files){const s=JSON.parse(e.files);C(s.map(l=>l.replace(/\\/,"/")))}}).catch(()=>{c(!1)})):m.includes("/")&&i&&(f("show"),c(!0),u.get(`/row/${i}`).then(({data:e})=>{if(c(!1),p(e.title||""),x(e.description||""),v(e.author||""),y(e.created_at||""),e.files){const s=JSON.parse(e.files);C(s.map(l=>l.replace(/\\/,"/")))}}).catch(()=>{c(!1)}))},[m,i,o.role,n]);const E=e=>{const s=[...e.target.files];$(s)},T=e=>{e.preventDefault();const s=new FormData;s.append("title",g),s.append("description",j),s.append("author",N||o.username),D.forEach((b,A)=>{s.append(`files[${A}]`,b)});const l=a==="update"?`/row/${i}`:"/row";(a==="update"?u.put:u.post)(l,s,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>n("/row")).catch(b=>console.error(a==="update"?"Error updating Row Items":"Error creating Row Items",b))},I=e=>e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".png")?"image":e.endsWith(".pdf")?"pdf":"other";return t.jsx("div",{className:"p-4 max-w-6xl mx-auto",children:t.jsxs("form",{onSubmit:T,className:"mt-4",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title"}),t.jsx(h,{type:"text",value:g,onChange:e=>p(e.target.value),className:"mt-1",disabled:a==="show"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),t.jsx(P,{value:j,onChange:e=>x(e.target.value),className:"mt-1",disabled:a==="show"})]}),["owner","row-e"].some(e=>o.role.includes(e))&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Author"}),t.jsx(h,{type:"text",value:N,className:"mt-1",disabled:!0})]}),a!=="create"&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Created At"}),t.jsx(h,{type:"text",value:k,className:"mt-1",disabled:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Files"}),t.jsx(h,{type:"file",multiple:!0,onChange:E,className:"mt-1 text-white-400",disabled:a==="show"||a==="update"}),a==="show"&&F.length>0&&t.jsx("div",{className:"mt-2",children:F.map((e,s)=>{const l=`https://mydapi.thedhruvish.com/storage/${e}`,w=I(l);return t.jsx("div",{className:"mb-2",children:w==="image"?t.jsxs("div",{children:[t.jsx("img",{src:l,alt:`File ${s+1}`,className:"max-w-xs max-h-40 object-cover"}),t.jsxs(d,{to:l,download:!0,className:"text-blue-600 hover:underline",children:["Download Image ",s+1]})]}):w==="pdf"?t.jsxs("div",{children:[t.jsxs(d,{to:l,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["View PDF ",s+1]}),t.jsxs(d,{to:l,download:!0,className:"text-blue-600 hover:underline ml-2",children:["Download PDF ",s+1]})]}):t.jsxs("div",{children:[t.jsxs(d,{to:l,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["View File ",s+1]}),t.jsxs(d,{to:l,download:!0,className:"text-blue-600 hover:underline ml-2",children:["Download File ",s+1]})]})},s)})})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsx(S,{type:a==="show"?"button":"submit",className:`bg-blue-500 text-white hover:bg-blue-600 w-[100px] ${!["owner","row"].some(e=>o.role.includes(e))&&a!=="create"?"hidden":""} `,onClick:()=>a==="show"&&n(`/row/${i}/edit`),children:["owner","row"].some(e=>o.role.includes(e))&&a!=="create"?a==="update"?"Update":a==="show"?"Edit":"Create":a==="create"?"Create":null}),t.jsx(S,{type:"button",className:"bg-gray-500 text-white hover:bg-gray-600 w-[100px]",onClick:()=>n("/row"),children:"Go To Home"})]})]})})}export{O as default};
