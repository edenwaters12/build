import{u as A,c as M,r as l,j as s,L as h,B as i,$ as E,T as H,e as I,I as F,C as O,b as P,f as U,g as _,h as T,i as B,k as S,l as Q,m as z,A as J,a as x,n as q,o as G,p as K}from"./index-C80r3nWj.js";import{P as W}from"./pen-r_-_yYU3.js";function Z(){const{user:a,setNotification:g}=A(),d=M(),[f,R]=l.useState([]),[k,u]=l.useState(!1),[w,p]=l.useState(null),[D,m]=l.useState(!1),[c,b]=l.useState("");l.useEffect(()=>{["owner","row"].some(o=>a.role.includes(o))||d("/404")},[a,d]);const j=()=>{u(!0),x.get("/rows").then(o=>{R(o.data),u(!1)}).catch(o=>{console.error("Error fetching todos",o),u(!1)})};l.useEffect(()=>{j()},[]);const C=o=>{p(o),m(!0)},L=()=>{w&&x.delete(`/row/${w.id}`).then(()=>{g("row was successfully deleted"),j()}).catch(o=>{g("Error deleting todo",o)}),m(!1),p(null)},$=async o=>{try{const e=await x.get(`/row/${o}/download`,{responseType:"blob"}),t=window.URL.createObjectURL(e.data),r=document.createElement("a");r.href=t,r.setAttribute("download",`${o}_${Date.now()}__${Math.random().toString(36).substring(2,10)}.zip`),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)}catch(e){console.error("Download failed:",e),alert("Failed to download the file. Please try again.")}},n=q(),V=l.useMemo(()=>{const o=[n.accessor("title",{header:"Title",cell:e=>e.getValue()}),n.accessor("description",{header:"Description",cell:e=>e.getValue()?e.getValue().length>25?`${e.getValue().substring(0,25)}...`:e.getValue():" "}),n.accessor("files",{header:"Files",cell:e=>{const t=JSON.parse(e.getValue()||"[]");return t.length>0?t.map((r,N)=>s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex flex-wrap gap-2 items-center justify-around",children:[s.jsxs(h,{to:`https://mydapi.thedhruvish.com/storage/${r}`,className:"text-blue-500 hover:underline",target:"_blank",children:["View File ",N+1]},N),t.length>0&&s.jsx(i,{className:"ml-4 hover:bg-blue-600",onClick:()=>$(e.row.original.id),children:s.jsx(E,{})})]})})):"No files"}}),n.display({id:"actions",header:"Actions",cell:({row:e})=>a.role==="owner"||a.role==="admin"?s.jsxs(s.Fragment,{children:[s.jsx(h,{to:`/row/${e.original.id}`,children:s.jsx(i,{className:"ml-4 hover:bg-blue-600",onClick:()=>C(e.original),children:s.jsx(W,{})})}),["owner","row-d"].some(t=>a.role.includes(t))&&s.jsx(i,{className:"ml-4 hover:bg-red-600",onClick:()=>C(e.original),children:s.jsx(H,{})})]}):s.jsx(h,{to:`/row/${e.original.id}`,className:"text-blue-500 hover:underline",children:"Show"})})];return(a.role==="owner"||a.role==="admin")&&o.push(n.accessor("author",{header:"Author",cell:e=>e.getValue()})),o},[n,a.role]),v=l.useMemo(()=>(f||[]).filter(o=>{var e,t;return(((e=o.title)==null?void 0:e.toLowerCase())||"").includes(c.toLowerCase())||(((t=o.description)==null?void 0:t.toLowerCase())||"").includes(c.toLowerCase())}),[f,c]),y=I({data:v,columns:V,getCoreRowModel:G(),getSortedRowModel:K()});return s.jsxs("div",{className:"p-4 mx-auto",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4",children:[s.jsx("h1",{className:"text-2xl font-semibold cursor-pointer",onClick:()=>b(""),children:"Row Items"}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center w-full sm:w-auto sm:space-x-4",children:[s.jsx(F,{type:"text",placeholder:"Search",value:c,onChange:o=>b(o.target.value),className:"py-2 px-4 rounded-md focus:outline-none focus:ring-2 sm:order-2 xl:w-[200px]"}),s.jsx(i,{className:"bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:order-2 xl:w-[100px]",onClick:()=>d("/row/new"),children:"Create"})]})]}),s.jsxs("div",{className:"mt-8",children:[s.jsx(O,{className:"overflow-x-auto",children:k?s.jsx("div",{className:"flex items-center justify-center p-4",children:s.jsx(P,{})}):v.length>0?s.jsxs(U,{children:[s.jsx(_,{children:y.getHeaderGroups().map(o=>s.jsx(T,{children:o.headers.map(e=>s.jsx(B,{className:"cursor-pointer",children:e.isPlaceholder?null:s.jsxs("div",{onClick:e.column.getToggleSortingHandler(),children:[S(e.column.columnDef.header,e.getContext()),{asc:" ðŸ”¼ ",desc:" ðŸ”½ "}[e.column.getIsSorted()]??null]})},e.id))},o.id))}),s.jsx(Q,{children:y.getRowModel().rows.map(o=>s.jsx(T,{children:o.getVisibleCells().map(e=>s.jsx(z,{children:S(e.column.columnDef.cell,e.getContext())},e.id))},o.id))})]}):s.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"No rows found."})}),s.jsx(J,{open:D,onClose:()=>m(!1),onConfirm:L,title:"Confirm Deletion",description:"Are you sure you want to delete this todo? This action cannot be undone."})]})]})}export{Z as default};
